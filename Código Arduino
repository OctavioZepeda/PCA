#include <Servo.h>

int IN1 = 9;
int IN2 = 8;
int ENA = 10;
int ENB = 5;
int IN3 = 6;
int IN4 = 7; 
//sensor
int hayobs = HIGH;
const int ProxSensor=3; //Declaring where the Out pin from the sensor is wired
//Motor Servo
Servo servoMotor;

/*  NOTA
El servomotor no fue utilizado debido a que debido a una mala conexion este dejo de funcionar.
Se adapto el vehiculo para su funcionamiento sin el servomotor. 

*/


void setup() {
  // put your setup code here, to run once:
  pinMode(IN1, OUTPUT);
  pinMode(IN2, OUTPUT);
  pinMode(ENA, OUTPUT);
  pinMode(ENB, OUTPUT);
  pinMode(IN3, OUTPUT);
  pinMode(IN4, OUTPUT);
  pinMode(13, OUTPUT);   // setting the pin modes, the "13" stands for the internal Arduino uno internal LED  
  pinMode(ProxSensor,INPUT); // then we have the out pin from the module
  Serial.begin(9600);
  //servoMotor.attach(12); //declaracion

};

void sensorled(){
  hayobs = digitalRead(ProxSensor);
  if(hayobs == LOW){
    Serial.println("Se detectoObjeto");    
  }else{
    Serial.println("No se ha detectado nada");
  }
}

void adelante(){
  //Direccion motor A
 digitalWrite (IN1, HIGH);
 digitalWrite (IN2, LOW);
 analogWrite (ENA,200); //Velocidad motor A
 //Direccion motor B
 digitalWrite (IN3, HIGH);
 digitalWrite (IN4, LOW);
 analogWrite (ENB, 180); //Velocidad motor B
}

void atras ()
{
 //Direccion motor A
 digitalWrite (IN1, LOW);
 digitalWrite (IN2, HIGH);
 analogWrite (ENA, 170); //Velocidad motor A
 //Direccion motor B
 digitalWrite (IN3, LOW);
 digitalWrite (IN4, HIGH);
 analogWrite (ENB, 180); //Velocidad motor B
}

void abrirPinza(){
  servoMotor.write(80);
}

void cerrarPinza(){
  servoMotor.write(112);
}
void parar ()
{
 //Direccion motor A
 digitalWrite (IN1, LOW);
 digitalWrite (IN2, LOW);
 analogWrite (ENA, 0); //Velocidad motor A
 //Direccion motor B
 digitalWrite (IN3, LOW);
 digitalWrite (IN4, LOW);
 analogWrite (ENB, 0); //Velocidad motor A
}


void derecha ()
{
 //Direccion motor A
 digitalWrite (IN1, HIGH);
 digitalWrite (IN2, LOW);
 analogWrite (ENA, 200); //Velocidad motor A
 //Direccion motor B
 digitalWrite (IN3, LOW);
 digitalWrite (IN4, HIGH);
 analogWrite (ENB, 170); //Velocidad motor A
}

void izquierda ()
{
 //Direccion motor A
 digitalWrite (IN1, LOW);
 digitalWrite (IN2, HIGH);
 analogWrite (ENA, 200); //Velocidad motor A
 //Direccion motor B
 digitalWrite (IN3, HIGH);
 digitalWrite (IN4, LOW);
 analogWrite (ENB, 200); //Velocidad motor A
}

void loop() {
  
  if(Serial.available()){
    char c = Serial.read();
    
    if(c == 'a'){
      adelante();    
     hayobs = digitalRead(ProxSensor);
      if(hayobs == LOW){
        //Serial.println("Se detectoObjeto");
        cerrarPinza();    
      }else{
        abrirPinza();
        //Serial.println("No se ha detectado nada");
      } 
    }else if(c == 'b'){
      atras();
    }else if(c == 'i'){
      izquierda();
    }else if(c == 'd'){
      derecha();
    }else if(c == 'p'){
      parar();
    }
   } 
}
